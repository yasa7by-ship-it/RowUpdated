-- #############################################################################
-- #
-- # Secure Admin Dashboard - Fresh Setup Script
-- # Version: 2.0 (Clean Build)
-- #
-- #############################################################################

-- -----------------------------------------------------------------------------
-- 1. EXTENSIONS & SCHEMA SETUP
-- -----------------------------------------------------------------------------
CREATE EXTENSION IF NOT EXISTS "pgcrypto" WITH SCHEMA "extensions";

-- -----------------------------------------------------------------------------
-- 2. CREATE TABLES (Order is important due to foreign keys)
-- -----------------------------------------------------------------------------
 
-- ROLES: Defines user roles like 'Admin', 'User'.
CREATE TABLE IF NOT EXISTS "public"."roles" (
    "id" uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    "name" text NOT NULL UNIQUE,
    "description" text,
    "created_at" timestamp with time zone DEFAULT now() NOT NULL
);
COMMENT ON TABLE public.roles IS 'Stores user roles and their descriptions.';

-- PERMISSIONS: Defines specific actions a user can take, e.g., 'manage:users'.
CREATE TABLE IF NOT EXISTS "public"."permissions" (
    "id" uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    "action" text NOT NULL UNIQUE,
    "description" text,
    "created_at" timestamp with time zone DEFAULT now() NOT NULL
);
COMMENT ON TABLE public.permissions IS 'Stores discrete actions that can be permitted.';

-- ROLE_PERMISSIONS: Maps permissions to roles (many-to-many relationship).
CREATE TABLE IF NOT EXISTS "public"."role_permissions" (
    "role_id" uuid NOT NULL REFERENCES public.roles(id) ON DELETE CASCADE,
    "permission_id" uuid NOT NULL REFERENCES public.permissions(id) ON DELETE CASCADE,
    PRIMARY KEY (role_id, permission_id)
);
COMMENT ON TABLE public.role_permissions IS 'Maps roles to their granted permissions.';

-- PROFILES: Stores public user data, linked to auth.users.
CREATE TABLE IF NOT EXISTS "public"."profiles" (
    "id" uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    "full_name" text,
    "email" text UNIQUE,
    "role_id" uuid REFERENCES public.roles(id) ON DELETE SET NULL,
    "updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
COMMENT ON TABLE public.profiles IS 'Stores public-facing user profile information.';

-- TRANSLATIONS: For internationalization (i1n).
CREATE TABLE IF NOT EXISTS "public"."translations" (
    "id" bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "lang_id" text NOT NULL,
    "key" text NOT NULL,
    "value" text NOT NULL,
    UNIQUE (lang_id, key)
);
COMMENT ON TABLE public.translations IS 'Stores key-value translations for different languages.';

-- APP_SETTINGS: For global, non-translatable application settings.
CREATE TABLE IF NOT EXISTS "public"."app_settings" (
    "key" text PRIMARY KEY,
    "value" text
);
COMMENT ON TABLE public.app_settings IS 'Stores global application settings like a site logo.';

-- -----------------------------------------------------------------------------
-- 3. ROW LEVEL SECURITY (RLS)
-- -----------------------------------------------------------------------------

-- Enable RLS on all tables
ALTER TABLE public.roles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.permissions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.role_permissions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.translations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.app_settings ENABLE ROW LEVEL SECURITY;

-- Helper function to check if the current user has a specific permission.
CREATE OR REPLACE FUNCTION public.has_permission(permission_action text)
RETURNS boolean
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public, auth
AS $$
BEGIN
  RETURN EXISTS (
    SELECT 1
    FROM public.profiles p
    JOIN public.role_permissions rp ON p.role_id = rp.role_id
    JOIN public.permissions perm ON rp.permission_id = perm.id
    WHERE p.id = auth.uid() AND perm.action = permission_action
  );
END;
$$;

-- PROFILES POLICIES
DROP POLICY IF EXISTS "Allow individual read/update access on profiles" ON "public"."profiles";
CREATE POLICY "Allow individual read/update access on profiles" ON "public"."profiles"
FOR ALL USING (auth.uid() = id);

DROP POLICY IF EXISTS "Allow managers read access on profiles" ON "public"."profiles";
CREATE POLICY "Allow managers read access on profiles" ON "public"."profiles"
FOR SELECT USING (public.has_permission('manage:users'));

-- ROLES, PERMISSIONS, ROLE_PERMISSIONS POLICIES
DROP POLICY IF EXISTS "Allow authenticated read access" ON "public"."roles";
CREATE POLICY "Allow authenticated read access" ON "public"."roles" FOR SELECT USING (auth.role() = 'authenticated');
DROP POLICY IF EXISTS "Allow authenticated read access" ON "public"."permissions";
CREATE POLICY "Allow authenticated read access" ON "public"."permissions" FOR SELECT USING (auth.role() = 'authenticated');
DROP POLICY IF EXISTS "Allow authenticated read access" ON "public"."role_permissions";
CREATE POLICY "Allow authenticated read access" ON "public"."role_permissions" FOR SELECT USING (auth.role() = 'authenticated');

DROP POLICY IF EXISTS "Allow managers full access" ON "public"."roles";
CREATE POLICY "Allow managers full access" ON "public"."roles" FOR ALL USING (public.has_permission('manage:roles'));
DROP POLICY IF EXISTS "Allow managers full access" ON "public"."role_permissions";
CREATE POLICY "Allow managers full access" ON "public"."role_permissions" FOR ALL USING (public.has_permission('manage:roles'));

-- TRANSLATIONS & APP_SETTINGS POLICIES
DROP POLICY IF EXISTS "Allow public read access" ON "public"."translations";
CREATE POLICY "Allow public read access" ON "public"."translations" FOR SELECT USING (true);
DROP POLICY IF EXISTS "Allow public read access" ON "public"."app_settings";
CREATE POLICY "Allow public read access" ON "public"."app_settings" FOR SELECT USING (true);

DROP POLICY IF EXISTS "Allow managers full access" ON "public"."translations";
CREATE POLICY "Allow managers full access" ON "public"."translations" FOR ALL USING (public.has_permission('manage:settings'));
DROP POLICY IF EXISTS "Allow managers full access" ON "public"."app_settings";
CREATE POLICY "Allow managers full access" ON "public"."app_settings" FOR ALL USING (public.has_permission('manage:settings'));

-- -----------------------------------------------------------------------------
-- 4. FUNCTIONS & TRIGGERS
-- -----------------------------------------------------------------------------

-- The core of the automatic setup. This trigger creates a profile for a new user.
-- CRUCIALLY, if it's the very first user, it automatically assigns them the 'Admin' role.
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = auth, public
AS $$
DECLARE
  user_count integer;
  admin_role_id uuid;
BEGIN
  -- Create the profile entry
  INSERT INTO public.profiles (id, full_name, email)
  VALUES (new.id, new.raw_user_meta_data->>'full_name', new.email);

  -- Check if this is the first user in the system
  SELECT count(*) INTO user_count FROM auth.users;

  -- If it is the first user, make them an admin.
  IF user_count = 1 THEN
    SELECT id INTO admin_role_id FROM public.roles WHERE name = 'Admin';
    IF admin_role_id IS NOT NULL THEN
      UPDATE public.profiles
      SET role_id = admin_role_id
      WHERE id = new.id;
    END IF;
  END IF;

  RETURN new;
END;
$$;

-- Trigger to call the function after a new user is created.
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();

-- -----------------------------------------------------------------------------
-- 5. SEED DATA (Initial data to get started)
-- -----------------------------------------------------------------------------
BEGIN;

-- Temporarily disable RLS to insert seed data
ALTER TABLE public.roles DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.permissions DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.role_permissions DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.translations DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.app_settings DISABLE ROW LEVEL SECURITY;

-- Seed Roles (Idempotent: will not fail if roles already exist)
INSERT INTO public.roles (name, description) VALUES
('Admin', 'Has full access to all system features and settings.'),
('User', 'Standard user with basic permissions.')
ON CONFLICT (name) DO NOTHING;

-- Seed Permissions (Idempotent: will not fail if permissions already exist)
INSERT INTO public.permissions (action, description) VALUES
('manage:users', 'Can view the user list and change user roles.'),
('manage:roles', 'Can view the role list and change role permissions.'),
('view:dashboard', 'Can view the main dashboard and statistics.'),
('manage:settings', 'Can update site-wide application settings.')
ON CONFLICT (action) DO NOTHING;

-- Seed Role-Permission Mappings (Idempotent)
DO $$
DECLARE
    admin_role_id uuid;
    user_role_id uuid;
    manage_users_perm_id uuid;
    manage_roles_perm_id uuid;
    view_dashboard_perm_id uuid;
    manage_settings_perm_id uuid;
BEGIN
    -- Get IDs
    SELECT id INTO admin_role_id FROM public.roles WHERE name = 'Admin';
    SELECT id INTO user_role_id FROM public.roles WHERE name = 'User';
    SELECT id INTO manage_users_perm_id FROM public.permissions WHERE action = 'manage:users';
    SELECT id INTO manage_roles_perm_id FROM public.permissions WHERE action = 'manage:roles';
    SELECT id INTO view_dashboard_perm_id FROM public.permissions WHERE action = 'view:dashboard';
    SELECT id INTO manage_settings_perm_id FROM public.permissions WHERE action = 'manage:settings';

    -- Assign all permissions to Admin
    INSERT INTO public.role_permissions (role_id, permission_id) VALUES
    (admin_role_id, manage_users_perm_id),
    (admin_role_id, manage_roles_perm_id),
    (admin_role_id, view_dashboard_perm_id),
    (admin_role_id, manage_settings_perm_id)
    ON CONFLICT (role_id, permission_id) DO NOTHING;
    
    -- Assign basic permission to User
    INSERT INTO public.role_permissions (role_id, permission_id) VALUES
    (user_role_id, view_dashboard_perm_id)
    ON CONFLICT (role_id, permission_id) DO NOTHING;
END $$;

-- Seed App Settings (Idempotent: will update if key exists)
INSERT INTO public.app_settings (key, value) VALUES
('site_logo', '<svg width="24" height="24" viewBox="0 0 24 24"><path fill="#f25022" d="M1 1h10v10H1z"></path><path fill="#7fba00" d="M13 1h10v10H13z"></path><path fill="#00a4ef" d="M1 13h10v10H1z"></path><path fill="#ffb900" d="M13 13h10v10H13z"></path></svg>')
ON CONFLICT (key) DO UPDATE SET value = EXCLUDED.value;

-- Seed Basic Translations (Idempotent: will update if key exists)
INSERT INTO public.translations (lang_id, key, value) VALUES
('en', 'site_title', 'Admin Panel'), ('ar', 'site_title', 'لوحة التحكم'),
('en', 'dashboard', 'Dashboard'), ('ar', 'dashboard', 'لوحة التحكم'),
('en', 'user_management', 'User Management'), ('ar', 'user_management', 'إدارة المستخدمين'),
('en', 'role_management', 'Role Management'), ('ar', 'role_management', 'إدارة الصلاحيات'),
('en', 'welcome_message', 'Welcome back! Here''s an overview.'), ('ar', 'welcome_message', 'أهلاً بعودتك! هذه نظرة عامة.'),
('en', 'total_users', 'Total Users'), ('ar', 'total_users', 'إجمالي المستخدمين'),
('en', 'total_roles', 'Total Roles'), ('ar', 'total_roles', 'إجمالي الصلاحيات'),
('en', 'save', 'Save'), ('ar', 'save', 'حفظ'),
('en', 'cancel', 'Cancel'), ('ar', 'cancel', 'إلغاء'),
('en', 'email', 'Email'), ('ar', 'email', 'البريد الإلكتروني'),
('en', 'full_name', 'Full Name'), ('ar', 'full_name', 'الاسم الكامل'),
('en', 'role', 'Role'), ('ar', 'role', 'الصلاحية'),
('en', 'actions', 'Actions'), ('ar', 'actions', 'الإجراءات'),
('en', 'roles', 'Roles'), ('ar', 'roles', 'الصلاحيات'),
('en', 'permissions', 'Permissions'), ('ar', 'permissions', 'الأذونات'),
('en', 'sign_out', 'Sign Out'), ('ar', 'sign_out', 'تسجيل الخروج'),
('en', 'dark_theme', 'Dark Theme'), ('ar', 'dark_theme', 'الوضع الداكن'),
('en', 'light_theme', 'Light Theme'), ('ar', 'light_theme', 'الوضع الفاتح'),
('en', 'select_language', 'Select Language'), ('ar', 'select_language', 'اختر اللغة'),
('en', 'password', 'Password'), ('ar', 'password', 'كلمة المرور'),
('en', 'access_denied', 'Access Denied'), ('ar', 'access_denied', 'الوصول مرفوض'),
('en', 'no_permission_message', 'You do not have permission to view this page.'), ('ar', 'no_permission_message', 'ليس لديك الصلاحية لعرض هذه الصفحة.'),
('en', 'loading', 'Loading'), ('ar', 'loading', 'جاري التحميل'),
('en', 'no_role', 'No Role'), ('ar', 'no_role', 'بدون صلاحية'),
('en', 'select_role', 'Select Role'), ('ar', 'select_role', 'اختر صلاحية'),
('en', 'edit_role', 'Edit Role'), ('ar', 'edit_role', 'تعديل الصلاحية'),
('en', 'create_account', 'Create Account'), ('ar', 'create_account', 'إنشاء حساب'),
('en', 'sign_up', 'Sign Up'), ('ar', 'sign_up', 'تسجيل'),
('en', 'login', 'Login'), ('ar', 'login', 'تسجيل الدخول'),
('en', 'remember_me', 'Remember me'), ('ar', 'remember_me', 'تذكرني'),
('en', 'already_have_account', 'Already have an account? Log in'), ('ar', 'already_have_account', 'لديك حساب بالفعل؟ سجل الدخول'),
('en', 'create_new_account', 'Need an account? Sign up'), ('ar', 'create_new_account', 'تحتاج حساب؟ قم بالتسجيل'),
('en', 'signup_success', 'Account created! Please check your email to confirm.'), ('ar', 'signup_success', 'تم إنشاء الحساب! يرجى التحقق من بريدك الإلكتروني للتأكيد.'),
('en', 'site_settings', 'Site Settings'), ('ar', 'site_settings', 'إعدادات الموقع'),
('en', 'site_title_en', 'Site Title (English)'), ('ar', 'site_title_en', 'عنوان الموقع (انجليزي)'),
('en', 'site_title_ar', 'Site Title (Arabic)'), ('ar', 'site_title_ar', 'عنوان الموقع (عربي)'),
('en', 'site_logo', 'Site Logo (SVG Code)'), ('ar', 'site_logo', 'شعار الموقع (كود SVG)'),
('en', 'save_success', 'Settings saved successfully!'), ('ar', 'save_success', 'تم حفظ الإعدادات بنجاح!'),
('en', 'save_error', 'Failed to save settings.'), ('ar', 'save_error', 'فشل حفظ الإعدادات.'),
('en', 'saving', 'Saving'), ('ar', 'saving', 'جاري الحفظ'),
('en', 'n_a', 'N/A'), ('ar', 'n_a', 'غير متوفر'),
('en', 'cannot_edit_last_admin', 'Cannot change the role of the last admin.'), ('ar', 'cannot_edit_last_admin', 'لا يمكن تغيير صلاحية آخر مدير.'),
('en', 'select_role_to_manage', 'Select a role to manage its permissions.'), ('ar', 'select_role_to_manage', 'اختر صلاحية لإدارة أذوناتها.'),
('en', 'admin_role_note', 'Admin permissions cannot be changed.'), ('ar', 'admin_role_note', 'لا يمكن تغيير أذونات صلاحية المدير.'),
('en', 'add_new_user', 'Add New User'), ('ar', 'add_new_user', 'إضافة مستخدم جديد'),
('en', 'edit_user', 'Edit User'), ('ar', 'edit_user', 'تعديل المستخدم'),
('en', 'password_initial', 'Password (Initial)'), ('ar', 'password_initial', 'كلمة المرور (مبدئية)'),
('en', 'edit', 'Edit'), ('ar', 'edit', 'تعديل'),
('en', 'send_password_reset', 'Send Password Reset Email'), ('ar', 'send_password_reset', 'إرسال بريد إعادة تعيين كلمة المرور'),
('en', 'reset_password_email_sent', 'Reset email sent!'), ('ar', 'reset_password_email_sent', 'تم إرسال البريد!'),
('en', 'reset_password_email_error', 'Failed to send. Try again.'), ('ar', 'reset_password_email_error', 'فشل الإرسال. حاول مجدداً.'),
('en', 'landing_page_description', 'Welcome to your secure management portal.'), 
('ar', 'landing_page_description', 'أهلاً بك في بوابة الإدارة الآمنة.')
ON CONFLICT (lang_id, key) DO UPDATE SET value = EXCLUDED.value;

-- Re-enable RLS
ALTER TABLE public.roles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.permissions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.role_permissions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.translations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.app_settings ENABLE ROW LEVEL SECURITY;

COMMIT;

-- #############################################################################
-- # USER NOTES FEATURE - ADDED 2024-08-01
-- #############################################################################
BEGIN;

-- Create the user_notes table.
CREATE TABLE IF NOT EXISTS public.user_notes (
  id BIGSERIAL PRIMARY KEY,
  user_id uuid NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  note_content TEXT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
COMMENT ON TABLE public.user_notes IS 'Stores notes and feedback submitted by users.';

-- Add the new permission to the permissions table.
INSERT INTO public.permissions (action, description)
VALUES
  ('manage:user_notes', 'Can view, manage, and export all user-submitted notes.'),
  ('submit:user_notes', 'Can access the "My Notes" page to submit feedback.')
ON CONFLICT (action) DO UPDATE SET description = EXCLUDED.description;

-- Assign the new permission to the Admin role.
DO $$
DECLARE
    admin_role_id UUID;
    user_role_id UUID;
    manage_notes_perm_id UUID;
    submit_notes_perm_id UUID;
BEGIN
    SELECT id INTO admin_role_id FROM public.roles WHERE name = 'Admin';
    SELECT id INTO user_role_id FROM public.roles WHERE name = 'User';
    SELECT id INTO manage_notes_perm_id FROM public.permissions WHERE action = 'manage:user_notes';
    SELECT id INTO submit_notes_perm_id FROM public.permissions WHERE action = 'submit:user_notes';

    -- Assign manage permission to Admin
    IF admin_role_id IS NOT NULL AND manage_notes_perm_id IS NOT NULL THEN
        INSERT INTO public.role_permissions (role_id, permission_id)
        VALUES (admin_role_id, manage_notes_perm_id)
        ON CONFLICT (role_id, permission_id) DO NOTHING;
    END IF;

    -- Assign submit permission to BOTH Admin and User by default
    IF admin_role_id IS NOT NULL AND submit_notes_perm_id IS NOT NULL THEN
        INSERT INTO public.role_permissions (role_id, permission_id)
        VALUES (admin_role_id, submit_notes_perm_id)
        ON CONFLICT (role_id, permission_id) DO NOTHING;
    END IF;

    IF user_role_id IS NOT NULL AND submit_notes_perm_id IS NOT NULL THEN
        INSERT INTO public.role_permissions (role_id, permission_id)
        VALUES (user_role_id, submit_notes_perm_id)
        ON CONFLICT (role_id, permission_id) DO NOTHING;
    END IF;

END $$;

-- Set up Row Level Security (RLS) on the new table.
ALTER TABLE public.user_notes ENABLE ROW LEVEL SECURITY;

DROP POLICY IF EXISTS "Allow users to insert their own notes" ON public.user_notes;
CREATE POLICY "Allow users to insert their own notes"
    ON public.user_notes FOR INSERT
    WITH CHECK (auth.uid() = user_id);

DROP POLICY IF EXISTS "Allow managers to read all notes" ON public.user_notes;
CREATE POLICY "Allow managers to read all notes"
    ON public.user_notes FOR SELECT
    USING (public.has_permission('manage:user_notes'));

-- Create RPC functions for secure data access.
CREATE OR REPLACE FUNCTION public.submit_user_note(p_note_content TEXT)
RETURNS void
LANGUAGE plpgsql
AS $$
BEGIN
  INSERT INTO public.user_notes (user_id, note_content)
  VALUES (auth.uid(), p_note_content);
END;
$$;

CREATE OR REPLACE FUNCTION public.get_all_user_notes(page_num INT, page_size INT, search_query TEXT DEFAULT '')
RETURNS TABLE (
    id bigint,
    created_at timestamptz,
    user_id uuid,
    note_content text,
    user_full_name text,
    user_email text,
    total_count bigint
)
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public, auth
AS $$
DECLARE
  query_offset INT;
BEGIN
  IF NOT public.has_permission('manage:user_notes') THEN
    RETURN;
  END IF;

  query_offset := (page_num - 1) * page_size;

  RETURN QUERY
  WITH filtered_notes AS (
    SELECT
      un.id,
      un.created_at,
      un.user_id,
      un.note_content,
      p.full_name AS user_full_name,
      p.email AS user_email
    FROM public.user_notes un
    JOIN public.profiles p ON un.user_id = p.id
    WHERE
      (search_query = '' OR search_query IS NULL OR p.email ILIKE '%' || search_query || '%' OR p.full_name ILIKE '%' || search_query || '%' OR un.note_content ILIKE '%' || search_query || '%')
  )
  SELECT
    fn.id,
    fn.created_at,
    fn.user_id,
    fn.note_content,
    fn.user_full_name,
    fn.user_email,
    count(*) OVER() AS total_count
  FROM filtered_notes fn
  ORDER BY fn.created_at DESC
  OFFSET query_offset
  LIMIT page_size;
END;
$$;

-- Add required UI translations.
ALTER TABLE public.translations DISABLE ROW LEVEL SECURITY;

INSERT INTO public.translations (lang_id, key, value) VALUES
('en', 'user_notes', 'My Notes'),
('ar', 'user_notes', 'ملاحظاتي'),
('en', 'manage_user_notes', 'Manage User Notes'),
('ar', 'manage_user_notes', 'إدارة ملاحظات المستخدمين'),
('en', 'perm_manage_user_notes', 'Manage User Notes'),
('ar', 'perm_manage_user_notes', 'إدارة ملاحظات المستخدمين'),
('en', 'perm_manage_user_notes_desc', 'Can view, manage, and export all user-submitted notes.'),
('ar', 'perm_manage_user_notes_desc', 'يمكنه عرض وإدارة وتصدير جميع الملاحظات المقدمة من المستخدمين.'),
('en', 'perm_submit_user_notes', 'Submit User Notes'),
('ar', 'perm_submit_user_notes', 'إرسال ملاحظات المستخدم'),
('en', 'perm_submit_user_notes_desc', 'Can access the "My Notes" page to submit feedback.'),
('ar', 'perm_submit_user_notes_desc', 'يمكنه الوصول إلى صفحة "ملاحظاتي" لإرسال الملاحظات.'),
('en', 'submit_your_notes', 'Submit Your Notes'),
('ar', 'submit_your_notes', 'أرسل ملاحظاتك'),
('en', 'write_your_notes_here', 'Write your notes here...'),
('ar', 'write_your_notes_here', 'اكتب ملاحظاتك هنا...'),
('en', 'save_and_send', 'Save and Send'),
('ar', 'save_and_send', 'حفظ وإرسال'),
('en', 'note_submitted_successfully', 'Your note has been submitted successfully. Thank you!'),
('ar', 'note_submitted_successfully', 'تم إرسال ملاحظتك بنجاح. شكراً لك!'),
('en', 'note_submission_failed', 'Failed to submit your note. Please try again.'),
('ar', 'note_submission_failed', 'فشل إرسال ملاحظتك. يرجى المحاولة مرة أخرى.'),
('en', 'note_content', 'Note Content'),
('ar', 'note_content', 'محتوى الملاحظة'),
('en', 'submitted_by', 'Submitted By'),
('ar', 'submitted_by', 'مقدمة من'),
('en', 'submission_date', 'Date'),
('ar', 'submission_date', 'التاريخ'),
('en', 'export_csv', 'Export CSV'),
('ar', 'export_csv', 'تصدير CSV'),
('en', 'print', 'Print'),
('ar', 'print', 'طباعة'),
('en', 'search_notes', 'Search by user or note content...'),
('ar', 'search_notes', 'ابحث بالمستخدم أو محتوى الملاحظة...')
ON CONFLICT (lang_id, key) 
DO UPDATE SET value = EXCLUDED.value;

ALTER TABLE public.translations ENABLE ROW LEVEL SECURITY;

COMMIT;

-- #############################################################################
-- # END OF SCRIPT
-- #############################################################################
