-- #############################################################################
-- #
-- # MIGRATION SCRIPT: Add Toggle for Educational Disclaimer
-- #
-- # Purpose: This script adds the backend infrastructure to allow an admin
-- # to control the visibility of the educational disclaimer banner on the
-- # "Last Day" analysis page.
-- #
-- # This script is safe to run multiple times.
-- #
-- #############################################################################

BEGIN;

-- Step 1: Add the new setting to app_settings with a default value of 'true'.
-- The ON CONFLICT clause prevents errors if the script is run more than once.
INSERT INTO public.app_settings (key, value) VALUES
('show_educational_disclaimer', 'true')
ON CONFLICT (key) DO NOTHING;

-- Step 2: Add new translation keys for the UI labels in the dashboard settings.
INSERT INTO public.translations (lang_id, key, value) VALUES
('en', 'show_educational_disclaimer_label', 'Show Educational Disclaimer'),
('ar', 'show_educational_disclaimer_label', 'إظهار تنبيه الأغراض التعليمية'),
('en', 'show_educational_disclaimer_desc', 'Controls the visibility of the green disclaimer banner at the top of the "Last Day" analysis page.'),
('ar', 'show_educational_disclaimer_desc', 'يتحكم في ظهور شريط التنبيه الأخضر في أعلى صفحة تحليل "آخر يوم".')
ON CONFLICT (lang_id, key) 
DO UPDATE SET value = EXCLUDED.value;

RAISE NOTICE 'SUCCESS: Added setting and translations for the educational disclaimer toggle.';

COMMIT;
