الغرض من هذا المستند هو تزويد أي فريق تطوير خارجي بمواصفات شاملة لإعادة تنفيذ منصة Trendview أو تحويلها إلى أي بيئة جديدة (موقع ويب، تطبيق جوال، تطبيق مكتبي، أو واجهة برمجة تطبيقات) باستخدام الموارد المتاحة أو بدائل مكافئة.

1. الأهداف الرئيسية
- إعادة بناء نظام يعرض ملخصًا للسوق الأمريكي، قوائم مراقبة يومية، تحليلات دقة التوقعات، وملف خاص بمؤشر ناسداك.
- الحفاظ على تجربة ثنائية اللغة (العربية والإنجليزية)، وإتاحة إمكانية عمل واجهة RTL و LTR.
- توفير واجهة مرنة يمكن تشغيلها على متصفح، أو تغليفها كتطبيق جوال (باستخدام Flutter, React Native, Ionic, Capacitor ...) أو كتطبيق مكتبي (Electron, Tauri).

2. الخيارات التقنية المقترحة (قابلة للتبديل)
- طبقة العرض: يمكن استخدام React, Vue, Angular، أو إطار هجين/محمول مثل Flutter أو React Native. المهم توفير مكونات جاهزة للبطاقات والمخططات.
- إدارة الحالة: Context API، Zustand، Pinia، MobX، Redux Toolkit، أو state management المدمجة في Flutter.
- طبقة البيانات: خيار افتراضي Supabase (PostgreSQL + Auth + Storage). بدائل مقبولة: Firebase + Cloud Functions، Hasura + PostgreSQL، أو API REST/GraphQL مخصصة. يجب الحفاظ على نفس بنية البيانات (الجداول والدوال) حتى لو تغيّر المزود.
- المخططات: Recharts, Chart.js, ApexCharts، أو أي مكتبة رسوميات متوافقة مع المنصة المختارة.
- التنبيهات والمهام الخلفية: Cron Jobs عبر المنصة المختارة (Supabase Scheduler, Cloud Functions, GitHub Actions, Render Cron, AWS Lambda) لتحديث البيانات اليومية والتقييمات.

3. المصادر المطلوبة للبيانات
- بيانات السوق اليومية يمكن الحصول عليها من Yahoo Finance أو Stooq أو Alpha Vantage (الخيار المجاني) أو أي مصدر مجاني آخر. يجب توفير طبقة استيراد تُخزّن الناتج في قاعدة البيانات (سواء عبر سكربت Python، أو خدمة Lambda، أو جدولة داخل التطبيق).
- جدول ناسداك (nasdaq_daily_snapshot) يجب أن يُحدث مرة واحدة يوميًا ببيانات الإغلاق. السكربت الحالي يبيّن الصيغة المطلوبة.
- بيانات التوقعات اليومية (get_daily_checklist) تعتمد على دوال موجودة في قاعدة البيانات؛ في حال تغيير المزود يجب إعادة تنفيذ الدوال لتعيد نفس البنية.

4. الوظائف الأساسية التي يجب توفيرها في الواجهة
- صفحة Landing برسائل تسويقية ومعلومات مترجمة من جدول translations (أو ملف موارد بديل).
- لوحة تحكم Admin لاستعراض عدد المستخدمين، المهام الأخيرة، وتشغيل عمليات التحديث والتقييم (تحتاج أزرار تشغيل واستعراض السجلات).
- Daily Watchlist: جدول يعرض توقعات اليوم التالي مع خيارات البحث، الفلاتر (Hits, Misses, All)، المفضلة، وترقيم الصفحات.
- Stock Analysis: نفس البيانات لكن مع بطاقات ملخص (آخر يوم عمل، إجمالي التوقعات، نسبة النجاح). يجب حساب التاريخ الأحدث لكل مجموعة بيانات قبل العرض.
- What Happened: جدول للجلسة الماضية مع تفاصيل السهم المختار (بيانات تاريخية، مؤشرات فنية، أنماط الشموع، التوقعات القادمة). التخزين المؤقت للبيانات محبّذ لتحسين الأداء.
- Nasdaq Snapshot: بطاقة رئيسية لبيانات ناسداك، بطاقات فرعية (التغير، الحجم، التوزيع)، جدول للتوقعات اليومية مطابق لـDaily Watchlist.
- Forecast Accuracy Dashboard: لوحة مؤشرات ومخططات (نسبة الدقة، MAPE، اتجاهات 30 يوم، توزيع الأخطاء، الأداء حسب الفترة).
- Forecast History Analysis: أدوات تصفية زمنية، مخططات للاتجاهات، وجداول قابلة للتصدير.
- صفحات الإدارة (Users, Roles, Translations, Announcements, Notes, Logs, Settings) مع صلاحيات مقيدة.

5. قاعدة البيانات والمتطلبات الخلفية
- يجب إنشاء الجداول والدوال وفق المواصفات الواردة في database_contents_ar.txt و database_component_spec_en.txt (الجداول، الحقول، الفهارس، الدوال، الـTriggers، سياسات RLS).
- إذا تم استخدام مزود بيانات بديل، فيجب تطبيق نفس نموذج البيانات والتسميات للحفاظ على توافق الواجهة.
- مطلوب دعم CRUD للمستخدمين والأدوار والترجمات والإعلانات والملاحظات.
- نظام المصادقة يمكن أن يكون Supabase Auth أو أي نظام OAuth/Email بديل مع تخزين ملف المستخدم وربطه بالدور.

6. متطلبات الواجهات البرمجية
- توفير طبقة API أو RPC تعيد البيانات التالية: daily checklist, stock details, what happened summary/details, nasdaq snapshot, forecast accuracy datasets, forecast history datasets, user management endpoints.
- يجب أن تسمح الطبقة الخلفية بتجميع الطلبات (Batch) أو caching للحد من الطلبات البطيئة.
- في حال استخدام GraphQL أو REST، يجب توثيق جميع المسارات المستعملة، Headers، وحدود الاستخدام.

7. البنية التحتية والنشر
- قابلية النشر على منصات متعددة: Vercel, Netlify, Render, AWS Amplify, Firebase Hosting، أو متجر تطبيقات (عند التغليف). يجب توفير تعليمات بناء عامة (أوامر build و start) وتعريف متغيرات البيئة (Database URL, Service Role Key, API base URL).
- استخدام manifest و service worker اختياري إذا كانت المنصة لا تدعم PWA، ولكن يجب تضمين المواصفات في حال نشر نسخة ويب.
- دعم CI/CD (GitHub Actions أو أي خدمة أخرى) لتشغيل الاختبارات وأتمتة نشر النسخة.

8. الاختبار وضمان الجودة
- تحضير بيانات seed (ملفات SQL أو JSON) لتعبئة الجداول الأساسية أثناء التطوير.
- اختبارات وحدات (Unit) واختبارات تكامل (Integration) للوظائف الحرجة (تقييم التوقعات، جلب بيانات ناسداك، تسجيل الدخول/الدور).
- ضمان التوافق بين العربية والإنجليزية، والتحقق من اتجاه الكتابة، والمظهر على الشاشات الصغيرة.
- اختبار أداء المخططات في الأجهزة منخفضة المواصفات، والتأكد من أن وقت التحميل أقل من 3 ثوانٍ في شروط شبكة متوسطة.

9. التسليمات المطلوبة من المطوّر
- الشفرة المصدرية الكاملة مع دليل تشغيل محدث (README) يشرح خطوات الإعداد لأي بيئة (ويب أو جوال أو سطح مكتب).
- ملفات التهيئة (env.template) موضّح فيها المتغيرات المطلوبة.
- سكربتات جلب البيانات (مثال Python أو خدمة سحابية) مع شرح طريقة جدولة التنفيذ اليومية.
- وثائق إضافية توضح بنية قاعدة البيانات والدوال (بالاستناد إلى database_component_spec_en.txt) وشرح الواجهات الرئيسية ووحدات الكود.
- خطة صيانة توضح كيفية تحديث البيانات، تشغيل المهام الدورية، واستكشاف الأخطاء.

10. الموارد المتوفرة للمستخدم الحالي (يمكن استغلالها أو استبدالها)
- حساب Supabase يتضمن الجداول والدوال الحالية.
- مستودع GitHub (يمكن استخدامه أو استضافة مشروع جديد).
- استضافة حالية على Render (يمكن الاستمرار بها أو النقل إلى مزود آخر).
- سكربت Python جاهز لجلب بيانات ناسداك (update_nasdaq_daily_snapshot_minimal_ny.py).
- ملفات ترجمة عربية/إنجليزية.
- إمكانية الوصول إلى بيانات مجانية من Yahoo Finance و Stooq.

ملاحظة: هذه المواصفات تهدف لمنح المطوّر حرية اختيار التقنيات، بشرط الالتزام بالمخرجات الوظيفية والبيانات المحددة، وضمان إمكانية التشغيل على أي بيئة جديدة دون الاعتماد على البنية الحالية بشكل صارم.
